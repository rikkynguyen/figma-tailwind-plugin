<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <style>
    :root {
      --bg: #1e1e2f;
      --surface: #2b2b3c;
      --border: #3f3f4f;
      --text: #e5e5e5;
      --muted: #aaa;
      --accent: #7f5af0;
      --accent-hover: #9c7fff;
      --radius: 10px;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
      font-size: 14px;
    }

    .container {
      padding: 24px;
      max-width: 400px;
      margin: auto;
    }

    h2 {
      margin: 0 0 8px;
      font-size: 18px;
      font-weight: 600;
    }

    p {
      margin-top: 0;
      color: var(--muted);
      font-size: 13px;
    }

    .card {
      background-color: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .collection-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 300px;
      overflow-y: auto;
    }

    .collection-item label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #3a3a4d;
      border-radius: var(--radius);
      padding: 12px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .collection-item label:hover {
      background-color: #4a4a5e;
    }

    .toggle {
      position: relative;
      width: 36px;
      height: 20px;
      background: #444;
      border-radius: 9999px;
      appearance: none;
      cursor: pointer;
      outline: none;
      transition: background 0.3s ease;
    }

    .toggle:checked {
      background-color: var(--accent);
    }

    .toggle::before {
      content: "";
      position: absolute;
      top: 2px;
      left: 2px;
      width: 16px;
      height: 16px;
      background: white;
      border-radius: 9999px;
      transition: transform 0.3s ease;
    }

    .toggle:checked::before {
      transform: translateX(16px);
    }

    button {
      width: 100%;
      background-color: var(--accent);
      color: white;
      border: none;
      padding: 12px;
      font-size: 14px;
      font-weight: 500;
      border-radius: var(--radius);
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: var(--accent-hover);
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>Export Tailwind CSS</h2>
    <p>Select the variable collections you want to export:</p>

    <div class="card">
      <div class="collection-list" id="collections"></div>
    </div>

    <button id="export">â¬‡ Export to CSS</button>
  </div>

  <script>
    const selected = new Set();

    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;

      if (msg.collections) {
        const container = document.getElementById("collections");
        container.innerHTML = "";
        msg.collections.forEach(col => {
          const div = document.createElement("div");
          div.className = "collection-item";

          const label = document.createElement("label");
          label.textContent = col.name;

          const toggle = document.createElement("input");
          toggle.type = "checkbox";
          toggle.className = "toggle";
          toggle.value = col.id;
          toggle.onchange = () => {
            toggle.checked ? selected.add(col.id) : selected.delete(col.id);
          };

          label.appendChild(toggle);
          div.appendChild(label);
          container.appendChild(div);
        });
      }

      if (msg.type === "download-css") {
        const blob = new Blob([msg.css], {
          type: "text/css"
        });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = "tailwind-theme.css";
        document.body.appendChild(link);
        link.click();
        link.remove();
      }
    };

    document.getElementById("export").onclick = () => {
      parent.postMessage({
        pluginMessage: {
          type: "export",
          selected: Array.from(selected)
        }
      }, "*");
    };

    // resize fix
    window.addEventListener("load", () => {
      setTimeout(() => {
        const height = document.documentElement.scrollHeight;
        const width = 400;
        parent.postMessage({
          pluginMessage: {
            type: "resize",
            width,
            height
          }
        }, "*");
      }, 50);
    });
  </script>
</body>

</html>
